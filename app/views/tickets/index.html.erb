<% content_for :title, "Tickets" %>

<% if notice %>
  <div class="alert alert-success" role="alert">
    <%= notice %>
  </div>
<% end %>

<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="mb-0">Tickets</h1>
  <%= link_to "Create Ticket", new_ticket_path, class: "btn btn-primary" %>
</div>
<hr>

<%= form_with url: tickets_path, method: :get, local: true, class: "row g-2 mb-4" do %>
  <div class="col-md-3">
    <%= text_field_tag :query,
                       params[:query],
                       class: "form-control",
                       placeholder: "Search" %>
  </div>

  <div class="col-md-1">
    <%= submit_tag "Search", class: "btn btn-primary w-100" %>
  </div>

  <% if params[:query].present? %>
    <div class="col-md-1">
      <%= link_to "Clear", tickets_path, class: "btn btn-secondary w-100" %>
    </div>
  <% end %>
<% end %>

<% if @tickets.any? %>
  <div class="row g-3">
    <% @tickets.each do |ticket| %>
      <div class="col-12">
        <div class="card shadow-sm">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h5 class="card-title"><%= ticket.title %></h5>
                <p class="card-subtitle mb-2 text-muted">ID: <%= ticket.id %> | <span class="badge <%= badge_class(ticket.status) %>"><%= ticket.status %></span> | Due: <%= ticket.due_date %></p>
              </div>
              <div>
                <%= link_to "View", "#", class: "btn btn-info btn-sm me-1", data: { bs_toggle: "modal", bs_target: "#showticketModal-#{ticket.id}" } %>
                <%= link_to "Edit", edit_ticket_path(ticket), class: "btn btn-warning btn-sm me-1" %>
                <%= link_to "Delete",
                            ticket_path(ticket),
                            data: { turbo_method: :delete, turbo_confirm: "Are you sure?" },
                            class: "btn btn-danger btn-sm" %>
              </div>
            </div>
            <p class="card-text mt-2"><%= truncate(ticket.description, length: 100) %></p>
            <p class="mb-0"><strong>Tags:</strong> <%= ticket.tags %></p>
          </div>
        </div>
      </div>

      <%= render partial: "show", locals: { ticket: ticket } %>
    <% end %>
  </div>
<% else %>
  <p class="alert alert-warning text-center text-muted fst-italic my-4">
    No records match your search.
  </p>
<% end %>
